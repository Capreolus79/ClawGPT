# Bug Fix Spec — 2026-02-08

## Bug 1: Workspace Viewer — "missing scope: operator.admin"

**Symptom:** Clicking the Workspace (folder) icon in the header opens the right panel but shows:
"Failed to load workspace: missing scope: operator.admin"

**Root Cause:** The `loadWorkspaceFiles()` method in `app.js` (line ~9705) uses `exec.run` to run a `find` command. The Gateway WebSocket connection doesn't have `operator.admin` scope.

**Fix:** The workspace viewer should use the Gateway's `exec.run` method but needs the connection to have proper scope. However, the real issue is that ClawGPT connects as a regular chat client, not an operator. 

**Approach:** Instead of `exec.run`, use the agent's own tool capabilities by sending a message asking the agent to list files, OR implement a fallback that uses the `read` tool via the gateway. Check if there's a Gateway `workspace.list` or `files.list` API. If `exec.run` requires operator scope, we need to either:
1. Request `operator.admin` scope during WebSocket auth
2. Find an alternative API that works with current scope
3. Use the `request('read', ...)` method if available

**Root cause confirmed:** In `app.js` line 4989, the connect message requests scopes `['operator.read', 'operator.write']` but NOT `operator.admin`. The `exec.run` Gateway method requires `operator.admin` scope.

**Fix:** Add `'operator.admin'` to the scopes array at line 4989:
```js
scopes: ['operator.read', 'operator.write', 'operator.admin'],
```

Also fix the two other connect messages that have empty scopes (lines 199 and 1926) — these are probe/mobile connections and should also have proper scopes.

**Files:** `app.js` (lines 199, 1926, 4989)

---

## Bug 2: Bottom Toolbar Buttons Cut Off / Overlapping

**Symptom:** The sidebar footer with Sessions, Cron Jobs, Settings, Help, and Collapse buttons overflows. "Cron Jobs" text wraps to two lines. Settings and Help buttons are partially hidden or cut off at the bottom of the viewport.

**Root Cause:** The sidebar footer buttons use full-width layout with text labels + icons that don't fit when there are 5 buttons. The footer at `style.css` line ~332 uses `gap: 12px` and each button has `padding: 12px 16px` with text labels.

**Fix:** Make the sidebar footer buttons more compact:
- Use icon-only buttons (no text labels) in the footer row, OR
- Reduce padding and font size, OR  
- Make the footer scrollable or use flex-wrap
- The sidebar footer already has a different layout at line ~2526 (`display: flex; align-items: center; gap: 8px`). There appear to be DUPLICATE CSS rules — footer defined at both line 332 and 2526. Reconcile these.

**Acceptance:** All 5 buttons (Sessions, Cron Jobs, Settings, Help, Collapse) must be fully visible and clickable without overflow on a 1366x768 viewport.

**Files:** `style.css` (sidebar-footer rules at lines ~332 and ~2526), `index.html` (footer HTML structure)

---

## Bug 3: Verify Artifacts Panel Works

**Test:** Send a message with a code block or HTML content to trigger artifact detection. Verify the Artifacts panel opens and renders content correctly. The Artifacts button (diamond icon) shows as disabled when no artifacts exist — this is expected. Need to verify it activates when artifacts are present.

**Files:** `app.js` (artifact detection and rendering logic)

---

## Priority
1. Bug 2 (toolbar cutoff) — visual, easy CSS fix
2. Bug 1 (workspace scope) — functional, needs API investigation
3. Bug 3 (artifacts verification) — testing only, may not need code changes
